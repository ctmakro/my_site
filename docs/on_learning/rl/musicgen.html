<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <script>
      (function() {
      var method;
      var methods = [
          'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',
          'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',
          'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',
          'timeline', 'timelineEnd', 'timeStamp', 'trace', 'warn'
      ];
      var length = methods.length;
      var console = (window.console = window.console || {});
      while (length--) {
          method = methods[length];
          // Only stub undefined methods.
          if (!console[method]) {
              console[method] = function () {};
          }
      }
      }());
      
      
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="./../../basic.css" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" href="./../../favicon.ico">
    <title>Music Generation</title>
  </head>
  <body id="body">
    <div class="navigation_area">
      <div class="navnode">
              <div class="navnode_title">/</div>
              <div class="navnode"><a href="./../../index.html">Index</a>
              </div>
              <div class="navnode"><a href="./../../bio.html">About</a>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/art</div>
                      <div class="navnode"><a href="./../../art/anycubic_kossel.html"> Anycubic Kossel 心得</a>
                      </div>
                      <div class="navnode"><a href="./../../art/ferenova.html"> Make a Ferenova</a>
                      </div>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/lit</div>
                      <div class="navnode"><a href="./../../lit/why_bad_idea.html">Why Smart People Have Bad Ideas</a>
                      </div>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/on_learning</div>
                      <div class="navnode"><a href="./../../on_learning/tf1c.html"> Compiling TensorFlow</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/course_resources.html">Learning Resources</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/fast_gan_in_keras.html"> Fast DCGAN in Keras</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/gan.html">GAN 生成式对抗网络</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/gd.html">Gradient Descent 梯度下降法</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/artist.html">Training of Artists</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/how_to.html">Baby steps for ML</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/resnet_keras.html">Residual Network in Keras</a>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/audio</div>
                              <div class="navnode"><a href="./../../on_learning/audio/wavenet_arch.html"> Behind WaveNet</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/image</div>
                              <div class="navnode"><a href="./../../on_learning/image/fast_lsgan.html">Fast LSGAN in Canton</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/image/style_transfer.html">On Style Transfer 风格转移</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/motor_model</div>
                              <div class="navnode"><a href="./../../on_learning/motor_model/motor.html">Learn models of motors</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/npeg</div>
                              <div class="navnode"><a href="./../../on_learning/npeg/npeg.html">NPEG图像压缩</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/activations</div>
                              <div class="navnode"><a href="./../../on_learning/activations/index.html">Activation Functions</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/activations/relu.html">Rectified Linear Unit 整流线性单元</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/rl</div>
                              <div class="navnode"><a href="./../../on_learning/rl/bipedal.html">BipedalWalker-v2</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/ddpg.html">DDPG Method</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/l2r.html">Learning to Run</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/musicgen.html">Music Generation</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/rl.html">RL is progressing rapidly</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/vrep.html">V-REP + Gym = RL</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/gru</div>
                              <div class="navnode"><a href="./../../on_learning/gru/gru.html">GRU and Convolutional GRU</a>
                              </div>
                      </div>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/on_life</div>
                      <div class="navnode"><a href="./../../on_life/beijing.html">北京收获</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/cc.html">什么是比特币</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/electrical.html">Power System Analysis</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/fanqiang.html">一起学翻墙</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/gd10000.html">广州电信冚家铲</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/lang.html"> 编程语言的选择</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/nocode.html"> 不写码 No Code</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/numjs.html">NumJs</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/reprod.html"> 确定性</a>
                      </div>
              </div>
      </div>
    </div>
    <div class="markdown_content"><h1 data-sourcepos="3:1-3:68">Superhuman Level Music Generation With Deep/Reinforcement Learning</h1>
<h2 data-sourcepos="5:1-5:8">TL;DR</h2>
<p data-sourcepos="7:1-7:182">Can neural networks generate music better than a human composer/producer? Can we generate a hit song that surpasses Taylor Swift in popularity? Here we discuss one possible approach.</p>
<h2 data-sourcepos="9:1-9:25">Abstract (please skip)</h2>
<p data-sourcepos="11:1-11:174">Blah blah. However, there are relatively few attempts at modeling general population's sound preference, not to mention generative approaches based on such models, Blah blah.</p>
<h2 data-sourcepos="13:1-13:14">Methodology</h2>
<h3 data-sourcepos="15:1-15:11">Dataset</h3>
<p data-sourcepos="17:1-17:173">One can almost trivially collect freely available sound/music preference data from online music hosting services like SoundCloud. Each collected entry would look as follows:</p>
<pre><code data-sourcepos="19:1-21:50" class="language-text">Waveform of sound/music, Times played, Times liked
</code></pre>
<p data-sourcepos="23:1-23:132">Since the sound/music is collected in its raw waveform form, there's no restriction on the type/kind of sound/music one can collect.</p>
<h3 data-sourcepos="25:1-25:21">Data augmentation</h3>
<p data-sourcepos="27:1-27:55">amplitude scaling, pitch shifting, time streching, etc.</p>
<h3 data-sourcepos="29:1-29:10">Metric</h3>
<p data-sourcepos="31:1-31:317">We believe that there's a common/general preference of certain sounds and their combinations over others among all human. For example it's very easy to name sounds that most people enjoy (piano) or detest (fingernail scratching). Therefore we define each sound/music sample's popularity with a scalar number p, where:</p>
<p data-sourcepos="33:1-33:49">p = Times liked / Times played * log(Times liked)</p>
<p data-sourcepos="35:1-35:19">Which ensures that:</p>
<ul data-sourcepos="37:1-39:0">
<li data-sourcepos="37:1-37:168">If a song was played a lot of times, but was liked only a few times, then it's not as popular as another song which was played less but liked by almost all listeners.</li>
<li data-sourcepos="38:1-39:0">If two songs are both liked by, for example 50% of the listeners, then the song which was liked by more people is more popular.</li>
</ul>
<p data-sourcepos="40:1-40:230">One must be aware of the fact that some genres, like Black HipHop/Rap might be played and liked more times on SoundClound than Billboard music, which sounds good but obviously not free on SoundCloud, and expect racism in the data.</p>
<h3 data-sourcepos="42:1-42:18">Rating network</h3>
<p data-sourcepos="44:1-44:362">Today it is common to train CNN models on sound samples' mel-spectrogram to extract features and fit objectives. This have been done by a lot of researchers from around the world, like in <a href="https://arxiv.org/pdf/1704.01280.pdf">https://arxiv.org/pdf/1704.01280.pdf</a>. Same have been done by the state-of-the-art speech synthesis model, with a modified Wavenet, as in <a href="https://arxiv.org/abs/1712.05884">https://arxiv.org/abs/1712.05884</a>.</p>
<p data-sourcepos="46:1-46:46">Thus one might construct a network as follows:</p>
<ul data-sourcepos="48:1-57:0">
<li data-sourcepos="48:1-48:64">input: Mel-spectrogram of entire sound/song sample. (128 dims)</li>
<li data-sourcepos="49:1-49:37">Conv1D(width=5, num_output_dim=128)</li>
<li data-sourcepos="50:1-50:6">ReLU</li>
<li data-sourcepos="51:1-51:18">Dense(128 to 64)</li>
<li data-sourcepos="52:1-52:6">ReLU</li>
<li data-sourcepos="53:1-53:24">... (please improvise)</li>
<li data-sourcepos="54:1-54:16">Dense(64 to 1)</li>
<li data-sourcepos="55:1-55:31">AvgPool(along time dimension)</li>
<li data-sourcepos="56:1-57:0">output: popularity score</li>
</ul>
<p data-sourcepos="58:1-58:131">And train the network to reduce the mean squared error of its prediction of the popularity score, given the samples in our dataset.</p>
<p data-sourcepos="60:1-60:167">Once the training is done, we got ourselves a model that could predict popularity given any sound sample of arbitary length. This network is called the Rating network.</p>
<h3 data-sourcepos="62:1-62:21">Sample generation</h3>
<p data-sourcepos="64:1-64:75">Given such a rating network, how can we generate high rating music from it?</p>
<p data-sourcepos="66:1-66:389">As presented in various deep learning research, given a discriminative model, one can trivially do gradient ascent/descent on input data with respect to some metric to obtain inputs that maximize/minimize such metric, or so-called &quot;dreaming&quot;. With dreaming we can produce images that maximize the excitation to a neuron, or maximize the probability of belonging to a category, given a CNN.</p>
<p data-sourcepos="68:1-68:247">We could do that with sounds as well: given a sound sample consists of only white noise, by doing gradient ascent on it with respect to its popularity score produced by the Rating network, one can easily obtain a sample with high popularity score.</p>
<p data-sourcepos="70:1-70:371">Such samples, if generated naively as mentioned above, are likely to be noisy and meaningless -- just like adversial samples. (adversial samples: input samples constructed to fool a discriminative network) Fortunately we already know how to deal with such side effects when generating samples by dreaming, for example in <a href="https://distill.pub/2017/feature-visualization/">https://distill.pub/2017/feature-visualization/</a>.</p>
<p data-sourcepos="72:1-72:243">The only problem with the gradient ascent/dreaming approach is that, since the Rating Network only captured features that could help it to rate sound/music, it basically ignored all the features that contributed little to the popularity score.</p>
<p data-sourcepos="74:1-74:466">For example consider drum patterns. Human prefer repetitive drum patterns (more predictable, less random). But there may not be drum samples in the dataset that are randomly generated (come on, who would upload such garbage?), so the network might completely ignore the regularity of drum patterns when estimating popularity. As a result, the sample generated by gradient ascent might contain randomly placed drum hits, which is of course not realistic and annoying.</p>
<p data-sourcepos="76:1-76:299">More technically, since our dataset can never cover the space of all possible sound samples (which is much larger than the space we live in), it is trivial to find an adversial sample which does not appear in the dataset, and does not sound natural at all, yet able to produce high popularity score.</p>
<p data-sourcepos="78:1-78:59">There are currently two approach to deal with this problem:</p>
<ol data-sourcepos="80:1-95:0">
<li data-sourcepos="80:1-87:0">
<p data-sourcepos="80:4-80:38">Gradient ascent with Adversial Loss</p>
<p data-sourcepos="82:5-82:141">We train a discriminator network that classifies samples from our dataset as real, and samples generated by the dreaming process as fake.</p>
<p data-sourcepos="84:5-84:222">Then we do gradient ascent to maximize not only the popularity score, but also the realness score out of the discriminator. By doing so we effectively limit the space of generated sound samples to those sounded 'real'.</p>
<p data-sourcepos="86:5-86:175">This technique (ensure samples' realness by imposing adversial loss) is widely used in image generation/image translation/image upsampling and obtained impressive results.</p>
</li>
<li data-sourcepos="88:1-95:0">
<p data-sourcepos="88:4-88:36">Reinforcement Learning to Produce</p>
<p data-sourcepos="90:5-90:157">We train a reinforcement learning agent by asking him to act on a music production machine (a piano for example) sequentially to produce pieces of music.</p>
<p data-sourcepos="92:5-92:123">The goal is to maximize the reward signal, which is generated by evaluating the produced music with our rating network.</p>
<p data-sourcepos="94:5-94:216">Since the space of all possible sound samples is now limited to only those samples that can be generated by this machine, it became much harder to come up with adversial samples that does not sound like anything.</p>
</li>
</ol>
<h2 data-sourcepos="96:1-96:10">Summary</h2>
<p data-sourcepos="98:1-98:134">That's about it. By successfully implementing this blogpost, you can earn yourself a position in the hall of fame of Computer Science.</p>
<p data-sourcepos="100:1-100:8">20171223</p>
</div>
    <div class="meta_string">
      <p>file: musicgen.md</p>
      <p>last modified: 2017-12-23 04:19</p>
    </div>
    <script>
      //if(window.HighlightEverything){window.HighlightEverything()}
      
    </script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/atom-one-light.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
      
    </script>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  </body>
</html>