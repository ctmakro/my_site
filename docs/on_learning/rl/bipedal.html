<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <script>
      (function() {
      var method;
      var methods = [
          'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',
          'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',
          'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',
          'timeline', 'timelineEnd', 'timeStamp', 'trace', 'warn'
      ];
      var length = methods.length;
      var console = (window.console = window.console || {});
      while (length--) {
          method = methods[length];
          // Only stub undefined methods.
          if (!console[method]) {
              console[method] = function () {};
          }
      }
      }());
      
      
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="./../../basic.css" rel="stylesheet" type="text/css">
    <link rel="shortcut icon" href="./../../favicon.ico">
    <title>BipedalWalker-v2</title>
  </head>
  <body id="body">
    <div class="navigation_area">
      <div class="navnode">
              <div class="navnode_title">/</div>
              <div class="navnode"><a href="./../../index.html">Index</a>
              </div>
              <div class="navnode"><a href="./../../bio.html">About</a>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/art</div>
                      <div class="navnode"><a href="./../../art/anycubic_kossel.html"> Anycubic Kossel 心得</a>
                      </div>
                      <div class="navnode"><a href="./../../art/ferenova.html"> Make a Ferenova</a>
                      </div>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/lit</div>
                      <div class="navnode"><a href="./../../lit/why_bad_idea.html">Why Smart People Have Bad Ideas</a>
                      </div>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/on_learning</div>
                      <div class="navnode"><a href="./../../on_learning/tf1c.html"> Compiling TensorFlow</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/course_resources.html">Learning Resources</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/fast_gan_in_keras.html"> Fast DCGAN in Keras</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/gan.html">GAN 生成式对抗网络</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/gd.html">Gradient Descent 梯度下降法</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/artist.html">Training of Artists</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/how_to.html">Baby steps for ML</a>
                      </div>
                      <div class="navnode"><a href="./../../on_learning/resnet_keras.html">Residual Network in Keras</a>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/audio</div>
                              <div class="navnode"><a href="./../../on_learning/audio/wavenet_arch.html"> Behind WaveNet</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/image</div>
                              <div class="navnode"><a href="./../../on_learning/image/fast_lsgan.html">Fast LSGAN in Canton</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/image/style_transfer.html">On Style Transfer 风格转移</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/motor_model</div>
                              <div class="navnode"><a href="./../../on_learning/motor_model/motor.html">Learn models of motors</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/npeg</div>
                              <div class="navnode"><a href="./../../on_learning/npeg/npeg.html">NPEG图像压缩</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/activations</div>
                              <div class="navnode"><a href="./../../on_learning/activations/index.html">Activation Functions</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/activations/relu.html">Rectified Linear Unit 整流线性单元</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/rl</div>
                              <div class="navnode"><a href="./../../on_learning/rl/bipedal.html">BipedalWalker-v2</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/ddpg.html">DDPG Method</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/l2r.html">Learning to Run</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/musicgen.html">Music Generation</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/rl.html">RL is progressing rapidly</a>
                              </div>
                              <div class="navnode"><a href="./../../on_learning/rl/vrep.html">V-REP + Gym = RL</a>
                              </div>
                      </div>
                      <div class="navnode">
                              <div class="navnode_title">/on_learning/gru</div>
                              <div class="navnode"><a href="./../../on_learning/gru/gru.html">GRU and Convolutional GRU</a>
                              </div>
                      </div>
              </div>
              <div class="navnode">
                      <div class="navnode_title">/on_life</div>
                      <div class="navnode"><a href="./../../on_life/beijing.html">北京收获</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/cc.html">什么是比特币</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/electrical.html">Power System Analysis</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/fanqiang.html">一起学翻墙</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/gd10000.html">广州电信冚家铲</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/lang.html"> 编程语言的选择</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/nocode.html"> 不写码 No Code</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/numjs.html">NumJs</a>
                      </div>
                      <div class="navnode"><a href="./../../on_life/reprod.html"> 确定性</a>
                      </div>
              </div>
      </div>
    </div>
    <div class="markdown_content"><h1 data-sourcepos="3:1-3:18">BipedalWalker-v2</h1>
<p data-sourcepos="5:1-5:178"><video controls loop autoplay src="https://openai-kubernetes-prod-scoreboard.s3.amazonaws.com/v1/evaluations/eval_yZqDtftNTmO8xIEoLwciQ/training_episode_batch_video.mp4"></video></p>
<p data-sourcepos="7:1-7:423">Reinforcement Learning in the real world is still an ill defined problem. The agent have to be greedy; But not too greedy. One might conjecture that an optimal agent should have bayesian behaviour, which again is not always what we want, nor the design goal of our brain. We want the agent to be curious so they could exploit the environment whenever possible, but not too curious so that they will continue to work for us.</p>
<p data-sourcepos="9:1-9:220">It's like training your employee. You want your employee to be exceptionally efficient at his job; while at the same time you want them to stay working for you. Which is hard, if not impossible. (unless you're Google...)</p>
<h2 data-sourcepos="11:1-11:17">The Impossible</h2>
<p data-sourcepos="13:1-13:17"><img src="bipedal1.jpg" alt="" /></p>
<p data-sourcepos="15:1-15:63"><a href="https://gym.openai.com/evaluations/eval_yZqDtftNTmO8xIEoLwciQ">https://gym.openai.com/evaluations/eval_yZqDtftNTmO8xIEoLwciQ</a></p>
<p data-sourcepos="17:1-17:169">BipedalWalker-v2 is a very hard environment on Gym. Your agent should run very fast, should not trip himself off, should use as little energy as possible. 即又要马儿跑，又要马儿不吃草</p>
<blockquote data-sourcepos="19:1-19:113">
<p data-sourcepos="19:2-19:113">This is not a tutorial. Go learn what is Gym and Reinforcement Learning. Some resources are listed in this blog.</p>
</blockquote>
<p data-sourcepos="21:1-21:485">&quot;Solving&quot; the environment require an average total reward of over 300 over 100 consecutive episodes. Which is NOTORIOUSLY HARD. (less than 5 people solved it on Gym) My DDPG agent (yes, the name of the algorithm) can get up to 305 for a few episodes, then the peformance drops for a while (agent start making stupid mistakes and fall), then rise up to 300, again and again. Which of course is unstable, and if you smooth the peformance curve you get the curve shown above (around 250).</p>
<p data-sourcepos="23:1-23:17"><img src="bipedal3.png" alt="" /></p>
<blockquote data-sourcepos="25:1-25:24">
<p data-sourcepos="25:2-25:24">above from another run.</p>
</blockquote>
<p data-sourcepos="27:1-27:308">From the curve you will also notice: It's not that hard to learn to walk. Since DDPG is deterministic, for exploration I added 1/fsquare noise to the output and decrease it overtime. The agent will learn the basics of walking at around 700 episode, when the noise is down low enough to stabilize the actions.</p>
<p data-sourcepos="29:1-29:32">Then I added some plotting code:</p>
<p data-sourcepos="31:1-31:17"><img src="bipedal4.png" alt="" /></p>
<p data-sourcepos="33:1-33:24">This is not what I want.</p>
<h2 data-sourcepos="35:1-35:31">The curse of online learning</h2>
<p data-sourcepos="37:1-37:361">Start by logging the training error. The training is not very stable. The critic seem to have a hard time fitting a few bad datapoints, and when those datapoints (from the replay memory) are being trained on, the critic loss (predicted vs projected Q-value) rises. And as soon as the critic loss rises, the actor loss rises, then we start to see agents falling.</p>
<p data-sourcepos="39:1-39:183">Why not just use Cross Entropy Method? Because for this problem, the number of parameter is too large for any unbiased offline method. It would take way too many episodes to converge.</p>
<h2 data-sourcepos="41:1-41:11">The Cure</h2>
<ul data-sourcepos="43:1-54:0">
<li data-sourcepos="43:1-46:0">
<p data-sourcepos="43:3-43:25">try lower learning rate</p>
<p data-sourcepos="45:3-45:258">the replay memory is growing. At first when there are only 100k pairs or so, Adam optimizer at its default setting can do a pretty descent job; But after reaching 1M pairs I think I should decrease the learning rate to reduce the variance of the gradients.</p>
</li>
<li data-sourcepos="47:1-50:0">
<p data-sourcepos="47:3-47:31">slightly deeper/wider network</p>
<p data-sourcepos="49:3-49:11">did help.</p>
</li>
<li data-sourcepos="51:1-54:0">
<p data-sourcepos="51:3-51:82">reduce deviation from proven good policies (eg. trust region policy optimiztion)</p>
</li>
</ul>
<h2 data-sourcepos="55:1-55:11">Appendix</h2>
<p data-sourcepos="57:1-57:68">There are 4 major stragegy to walk, your agent is using one of them.</p>
<p data-sourcepos="59:1-59:17"><img src="bipedal2.png" alt="" /></p>
</div>
    <div class="meta_string">
      <p>file: bipedal.md</p>
      <p>last modified: 2017-03-13 06:56</p>
    </div>
    <script>
      //if(window.HighlightEverything){window.HighlightEverything()}
      
    </script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/atom-one-light.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
      
    </script>
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  </body>
</html>